#!/usr/bin/env python3
# -*- coding: utf-8 -*-

from pptx import Presentation
from pptx.util import Inches, Pt
from pptx.enum.text import PP_ALIGN
from pptx.dml.color import RGBColor
from pptx.oxml.xmlchemy import OxmlElement

# ??????
CHINESE_FONT = "WenQuanYi Zen Hei"

def set_font(paragraph, font_name):
    """?????????????"""
    try:
        for run in paragraph.runs:
            run.font.name = font_name
            # ??????
            if hasattr(run.font, '_element'):
                rPr = run.font._element.get_or_add_rPr()
                # ????????
                ea = OxmlElement('a:ea')
                ea.set('typeface', font_name)
                rPr.append(ea)
                # ????????
                cs = OxmlElement('a:cs')
                cs.set('typeface', font_name)
                rPr.append(cs)
    except:
        pass

def create_presentation():
    # ??????
    prs = Presentation()
    prs.slide_width = Inches(10)
    prs.slide_height = Inches(7.5)
    
    # ?????
    slide_layout = prs.slide_layouts[6]  # ????
    slide = prs.slides.add_slide(slide_layout)
    
    # ????
    title_box = slide.shapes.add_textbox(Inches(1), Inches(2.5), Inches(8), Inches(1))
    title_frame = title_box.text_frame
    title_frame.text = "??????"
    title_para = title_frame.paragraphs[0]
    title_para.font.name = CHINESE_FONT
    title_para.font.size = Pt(48)
    title_para.font.bold = True
    title_para.font.color.rgb = RGBColor(0, 51, 102)
    title_para.alignment = PP_ALIGN.CENTER
    set_font(title_para, CHINESE_FONT)
    
    # ?????
    subtitle_box = slide.shapes.add_textbox(Inches(1), Inches(4), Inches(8), Inches(0.5))
    subtitle_frame = subtitle_box.text_frame
    subtitle_frame.text = "???????"
    subtitle_para = subtitle_frame.paragraphs[0]
    subtitle_para.font.name = CHINESE_FONT
    subtitle_para.font.size = Pt(24)
    subtitle_para.font.color.rgb = RGBColor(89, 89, 89)
    subtitle_para.alignment = PP_ALIGN.CENTER
    set_font(subtitle_para, CHINESE_FONT)
    
    # ?????????
    add_section_slide(prs, "??????", [
        "????",
        "? ????????????",
        "? ?????????????",
        "? ???????????",
        "? ???????????",
        "",
        "????",
        "? ????????",
        "? ????????",
        "? ???????",
        "? ???????",
        "? ?????????",
        "",
        "????",
        "? ?????2023?4?",
        "? ?????2023?4? - 10?",
        "? ???????????"
    ])
    
    # ?????????
    add_section_slide(prs, "??????", [
        "??????",
        "",
        "1. ???????",
        "   ? ??????",
        "   ? ??????",
        "   ? ??????",
        "   ? ???????",
        "",
        "2. ????",
        "   ? ??????",
        "   ? ???????",
        "   ? ???????",
        "   ? ??????",
        "",
        "3. ????",
        "   ? ?????",
        "   ? ????",
        "   ? ????",
        "   ? ????"
    ])
    
    add_section_slide(prs, "?????????", [
        "4. ????",
        "   ? ????",
        "   ? ????",
        "   ? ????",
        "   ? ???????UAT?",
        "",
        "5. ????",
        "   ? ??????",
        "   ? ??????",
        "   ? ???????",
        "   ? ??????",
        "",
        "6. ????",
        "   ? 7?24??????",
        "   ? ????????",
        "   ? ???????",
        "   ? ???????"
    ])
    
    # ?????????
    add_section_slide(prs, "??????", [
        "????",
        "? ?????????Web??",
        "? ??????RESTful API??",
        "? ??????ORM????",
        "? ???????????? + ??",
        "? ???????????",
        "",
        "??????",
        "? ????????????????",
        "? ?????????????",
        "? ????????????????",
        "? ????????????",
        "? ????????????????",
        "",
        "????",
        "? ????????????????",
        "? ?????????????",
        "? ??????????????"
    ])
    
    # ?????????????
    add_section_slide(prs, "??????????", [
        "1. ????",
        "? ???????Scrum?",
        "? ????????",
        "? ??????????CI/CD?",
        "? ?????????",
        "? ?????Daily Standup?",
        "",
        "2. ?????",
        "? ?????1???????",
        "? ??????1???????",
        "? ??????2-3?",
        "? ??????3-4?",
        "? ??????2?",
        "? UI/UX????1-2?",
        "",
        "3. ????",
        "? ???????????",
        "? ?????????/??",
        "? ?????Confluence????",
        "? ?????Git????"
    ])
    
    add_section_slide(prs, "???????????", [
        "4. ????",
        "",
        "??????",
        "? 2023?4? - ???????",
        "? 2023?5? - ???????",
        "? 2023?6? - ?????????",
        "? 2023?7-9? - ??????",
        "? 2023?10? - ?????bug??",
        "",
        "?????11???",
        "? ?????????",
        "? ?????????",
        "? ????????",
        "? ??????",
        "",
        "?????12???",
        "? ???????",
        "? ??????",
        "? ???????",
        "? ???????"
    ])
    
    add_section_slide(prs, "???????????", [
        "5. ?????",
        "",
        "????????",
        "? ????????????",
        "? ??????",
        "? ????????",
        "? ???????",
        "? ??????",
        "",
        "????????",
        "? ????????",
        "? ??????",
        "? ??????",
        "? ??????",
        "? Bug????",
        "",
        "?????",
        "? ??????",
        "? ??????",
        "? ??????",
        "? ???????"
    ])
    
    # ????????
    add_section_slide(prs, "?????", [
        "1. ?????",
        "? ?????????????",
        "? ???????",
        "? ??????DDL + DML?",
        "? ????????",
        "? ??????????",
        "",
        "2. ?????",
        "? ???????",
        "? ?????????+?????",
        "? ???????",
        "? API????",
        "? ??????",
        "? ??????",
        "? ??????",
        "",
        "3. ?????",
        "? ?????PPT",
        "? ??????PPT",
        "? ??????",
        "? ???????FAQ?"
    ])
    
    add_section_slide(prs, "????????- ??????", [
        "4. ??????",
        "",
        "???????",
        "? ???????<500ms?95??<1s",
        "? ???????1000+????",
        "? ?????CPU<60%???<70%",
        "? ??????>99.5%",
        "",
        "???????",
        "? ????????",
        "? ????????30%+",
        "? ?????????",
        "? ?????????",
        "",
        "???????",
        "? Bug??????98%??",
        "? ??????????>80%",
        "? ??????????",
        "",
        "?????",
        "? ????????",
        "? ????????",
        "? ????????"
    ])
    
    # ??????? - ????
    add_section_slide(prs, "??????", [
        "??????",
        "",
        "1. ??????",
        "? ????????",
        "? ??????",
        "? ????????",
        "? ???????UAT???",
        "? ????????",
        "? ?????????",
        "",
        "2. ??????",
        "? ??????????",
        "? ?????????",
        "? ????????",
        "? ????????",
        "",
        "3. ????",
        "? ????????100%?",
        "? ?????????SLA???",
        "? ???????",
        "? ???????"
    ])
    
    add_section_slide(prs, "?????????", [
        "????",
        "",
        "1. ????",
        "? ????????",
        "? ????????",
        "? ?????????",
        "? ????????",
        "? ????????",
        "",
        "2. ????",
        "? ??????",
        "? ??????",
        "? ????????",
        "? ????????",
        "",
        "3. ?????",
        "? ???????",
        "? ??????",
        "? SQL????",
        "? XSS????",
        "? ??????",
        "",
        "4. ?????",
        "? ???????",
        "? ?????",
        "? ???????"
    ])
    
    add_section_slide(prs, "?????????", [
        "?????????",
        "",
        "???????????1??",
        "? ????????",
        "? ????????",
        "? ?????????",
        "",
        "???????????2-3??",
        "? ??????UAT??",
        "? ????????",
        "? ?????????",
        "",
        "???????????4??",
        "? ??????",
        "? ???????",
        "? ???????",
        "? ???????",
        "? ??????",
        "",
        "???????",
        "? ????????",
        "? ????????",
        "? ???????",
        "? ????????",
        "? ?????????"
    ])
    
    add_section_slide(prs, "?????????", [
        "???????",
        "",
        "?????",
        "? ??????????bug",
        "   ???????????",
        "",
        "? ?????????????",
        "   ??????????????",
        "",
        "? ????????????",
        "   ??????????????",
        "",
        "? ????????????",
        "   ??????????????",
        "",
        "?????????",
        "? ?????????",
        "? ??????????",
        "? ??????????",
        "? ???????????",
        "? ?????????",
        "? ??????????"
    ])
    
    # ???
    add_section_slide(prs, "???????", [
        "????",
        "? ???????????",
        "? ???????????",
        "? ???????????",
        "? ????????????",
        "",
        "????",
        "? ?????????????",
        "? ???????????",
        "? ???????????",
        "? ???????????",
        "",
        "????",
        "? ????????",
        "? ??????",
        "? ??????",
        "? ???????",
        "? ??????",
        "",
        "??",
        "? ??????????????",
        "? ?????????????",
        "? ????????????"
    ])
    
    # ???
    slide_layout = prs.slide_layouts[6]
    slide = prs.slides.add_slide(slide_layout)
    
    end_box = slide.shapes.add_textbox(Inches(1), Inches(3), Inches(8), Inches(1.5))
    end_frame = end_box.text_frame
    end_frame.text = "???\n\nQ & A"
    for para in end_frame.paragraphs:
        para.font.name = CHINESE_FONT
        para.font.size = Pt(44)
        para.font.bold = True
        para.font.color.rgb = RGBColor(0, 51, 102)
        para.alignment = PP_ALIGN.CENTER
        set_font(para, CHINESE_FONT)
    
    # ??????
    output_file = '/workspace/Project_Report.pptx'
    prs.save(output_file)
    print(f"? PPT?????")
    print(f"?? ?????{output_file}")
    print(f"?? ????????{CHINESE_FONT}")
    return output_file

def add_section_slide(prs, title, content_list):
    """?????"""
    slide_layout = prs.slide_layouts[6]  # ????
    slide = prs.slides.add_slide(slide_layout)
    
    # ????
    title_box = slide.shapes.add_textbox(Inches(0.5), Inches(0.5), Inches(9), Inches(0.8))
    title_frame = title_box.text_frame
    title_frame.text = title
    title_para = title_frame.paragraphs[0]
    title_para.font.name = CHINESE_FONT
    title_para.font.size = Pt(32)
    title_para.font.bold = True
    title_para.font.color.rgb = RGBColor(0, 51, 102)
    set_font(title_para, CHINESE_FONT)
    
    # ????
    content_box = slide.shapes.add_textbox(Inches(0.5), Inches(1.5), Inches(9), Inches(5.5))
    content_frame = content_box.text_frame
    content_frame.word_wrap = True
    
    for i, line in enumerate(content_list):
        if i == 0:
            p = content_frame.paragraphs[0]
        else:
            p = content_frame.add_paragraph()
        
        p.text = line
        p.font.name = CHINESE_FONT
        p.font.size = Pt(15)
        p.space_after = Pt(5)
        
        # ????
        if line.startswith('?'):
            p.level = 0
            p.font.size = Pt(15)
        elif line.startswith('   ?'):
            p.level = 1
            p.font.size = Pt(13)
        elif line.startswith('   '):
            p.level = 1
            p.font.size = Pt(13)
        
        # ?????
        if line and not line.startswith(' ') and not line.startswith('?') and not line.startswith('?') and not line.startswith('?') and not line.startswith('?') and not line.startswith('?') and ':' not in line and '?' not in line and line != "":
            p.font.bold = True
            p.font.size = Pt(18)
            p.font.color.rgb = RGBColor(0, 51, 102)
        
        set_font(p, CHINESE_FONT)

if __name__ == "__main__":
    create_presentation()
